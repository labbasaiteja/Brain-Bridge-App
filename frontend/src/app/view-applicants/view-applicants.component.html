<div class="p-4">
  <h2 class="text-2xl font-bold mb-4">View Applicants</h2>

  <label class="block mb-4 font-semibold">
    Select Assistantship:
    <select class="mt-1 p-2 rounded border w-full" [(ngModel)]="selectedPostingId" (change)="loadApplicants()">
      <option [ngValue]="null" disabled>Select a position</option>
      <option *ngFor="let posting of assistantships" [ngValue]="posting._id">
        {{ posting.title }}
      </option>
    </select>
  </label>

  <div *ngIf="selectedPostingId && applicants.length === 0" class="text-gray-500 mt-4">
    No applicants yet for this posting.
  </div>

  <div *ngIf="applicants.length > 0" class="grid gap-4 mt-4">
    <div *ngFor="let applicant of applicants" class="bg-white shadow rounded-lg p-4 flex justify-between items-center">
      <div>
        <p class="font-semibold text-lg">{{ applicant.studentName }}</p>
        <p class="text-gray-600">{{ applicant.studentEmail }}</p>
        <p class="text-gray-600">Submitted: {{ applicant.submittedAt | date:'mediumDate' }}</p>
        <p class="text-gray-600">Status: 
          <span [ngClass]="{
            'text-green-700 font-semibold': applicant.status === 'accepted',
            'text-red-600 font-semibold': applicant.status === 'rejected',
            'text-gray-500': !applicant.status
          }">{{ applicant.status || 'Pending' }}</span>
        </p>
      </div>

      <div class="flex items-center gap-4">
        <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-500" (click)="openModal(applicant)">
          View
        </button>
        <button class="bg-gray-100 text-gray-800 px-4 py-2 rounded hover:bg-gray-200"
                (click)="openStatusModal(applicant)">
          Update Status
        </button>
      </div>
    </div>
  </div>

  <!-- View Modal -->
  <div *ngIf="selectedApplicant" class="modal-overlay">
    <div class="modal">
      <button class="modal-close" (click)="closeModal()" aria-label="Close modal">&times;</button>

      <h3 class="text-xl font-bold mb-2">{{ selectedApplicant.studentName }}</h3>
      <p><strong>Email:</strong> {{ selectedApplicant.studentEmail }}</p>
      <p><strong>Submitted At:</strong> {{ selectedApplicant.submittedAt | date:'medium' }}</p>
      <p class="mt-4 mb-2 font-semibold">Motivation:</p>
      <p class="whitespace-pre-line mb-4">{{ selectedApplicant.motivation }}</p>
    </div>
  </div>

  <!-- Status Modal -->
  <div *ngIf="statusModalApplicant" class="modal-overlay">
    <div class="modal w-80 text-center p-6">
      <button class="modal-close" (click)="closeStatusModal()" aria-label="Close modal">&times;</button>

      <h3 class="text-xl font-bold mb-6">Application Status</h3>

      <div class="flex flex-col gap-3">
        <button class="border border-gray-300 text-black py-2 rounded hover:bg-green-500"
                (click)="updateStatus(statusModalApplicant, 'accepted')">
          Accept
        </button>
        <button class="border border-gray-300 text-black py-2 rounded hover:bg-red-500"
                (click)="updateStatus(statusModalApplicant, 'rejected')">
          Reject
        </button>
      </div>
    </div>
  </div>
</div>
